<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BJCP评审快速生成</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .main-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header {
            background: #5856d6;
            color: white;
            text-align: center;
            padding: 20px;
            margin: -20px -20px 20px -20px;
            border-radius: 8px 8px 0 0;
            font-size: 18px;
            font-weight: bold;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }

        .checkbox-item label {
            font-size: 14px;
            cursor: pointer;
        }

        .evaluation-form {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .eval-section {
            margin-bottom: 25px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }

        .eval-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .score-line {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .score-label {
            font-weight: bold;
            margin-right: 10px;
        }

        .score-value {
            font-weight: bold;
            color: #5856d6;
            margin-right: 10px;
        }

        .score-max {
            color: #666;
            font-size: 14px;
        }

        .eval-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .eval-row:last-child {
            border-bottom: none;
        }

        .eval-label {
            width: 80px;
            font-weight: bold;
            color: #333;
        }

        .eval-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .eval-text {
            flex: 1;
            min-height: 20px;
            color: #333;
            cursor: pointer;
            padding: 4px 8px;
            border: 1px solid transparent;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .eval-text:hover {
            background-color: #f0f0f0;
            border-color: #5856d6;
        }

        .eval-text:empty::before {
            content: "点击选择评语";
            color: #999;
            font-style: italic;
        }

        .eval-text.focused {
            background-color: #e8f4fd;
            border-color: #5856d6;
            outline: 2px solid #5856d6;
            outline-offset: 1px;
        }

        .copy-btn {
            background: #5856d6;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .copy-btn:hover {
            opacity: 1;
        }

        .comment-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .comment-text {
            font-size: 14px;
            line-height: 1.5;
            color: #333;
        }

        .final-score {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .final-score-value {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
        }

        .submit-btn {
            background: #5856d6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }

        .submit-btn:hover {
            background: #4c4bc7;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #333;
        }

        .modal-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .modal-option {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            background: white;
        }

        .modal-option:hover {
            background-color: #f0f0f0;
            border-color: #5856d6;
        }

        .modal-option.selected {
            background-color: #5856d6;
            color: white;
            border-color: #5856d6;
        }

        .modal-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .modal-btn-primary {
            background: #5856d6;
            color: white;
        }

        .modal-btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .modal-btn:hover {
            opacity: 0.9;
        }

        .header-controls {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
            gap: 10px;
        }

        .clear-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .clear-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <div class="header">作品评审</div>
            
            <div class="header-controls">
                <button class="clear-btn" onclick="clearAllComments()">清空评语</button>
            </div>
            
            <div class="evaluation-form">
                <div class="eval-section">
                    <div class="score-line">
                        <span class="score-label">香气评分</span>
                        <span class="score-value">11</span>
                        <span class="score-max">（最高12分）</span>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">麦芽</div>
                        <div class="eval-content">
                            <div class="eval-text" id="aroma-malt-text" onclick="openModal('aroma', 'malt', 'aroma-malt-text')"></div>
                            <button class="copy-btn" onclick="copyText('aroma-malt-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">啤酒花</div>
                        <div class="eval-content">
                            <div class="eval-text" id="aroma-hop-text" onclick="openModal('aroma', 'hop', 'aroma-hop-text')"></div>
                            <button class="copy-btn" onclick="copyText('aroma-hop-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">发酵风味</div>
                        <div class="eval-content">
                            <div class="eval-text" id="aroma-ferment-text" onclick="openModal('aroma', 'fermentation', 'aroma-ferment-text')"></div>
                            <button class="copy-btn" onclick="copyText('aroma-ferment-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">其他</div>
                        <div class="eval-content">
                            <div class="eval-text" id="aroma-other-text" onclick="openModal('aroma', 'other', 'aroma-other-text')"></div>
                            <button class="copy-btn" onclick="copyText('aroma-other-text')">复制</button>
                        </div>
                    </div>
                </div>

                <div class="eval-section">
                    <div class="score-line">
                        <span class="score-label">外观评分</span>
                        <span class="score-value">2</span>
                        <span class="score-max">（最高3分）</span>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">颜色</div>
                        <div class="eval-content">
                            <div class="eval-text" id="appearance-color-text" onclick="openModal('appearance', 'color', 'appearance-color-text')"></div>
                            <button class="copy-btn" onclick="copyText('appearance-color-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">清澈度</div>
                        <div class="eval-content">
                            <div class="eval-text" id="appearance-clarity-text" onclick="openModal('appearance', 'clarity', 'appearance-clarity-text')"></div>
                            <button class="copy-btn" onclick="copyText('appearance-clarity-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">泡沫颜色</div>
                        <div class="eval-content">
                            <div class="eval-text" id="appearance-foam-text" onclick="openModal('appearance', 'foam', 'appearance-foam-text')"></div>
                            <button class="copy-btn" onclick="copyText('appearance-foam-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">泡沫持久度</div>
                        <div class="eval-content">
                            <div class="eval-text" id="appearance-foam-retention-text" onclick="openModal('appearance', 'foam_retention', 'appearance-foam-retention-text')"></div>
                            <button class="copy-btn" onclick="copyText('appearance-foam-retention-text')">复制</button>
                        </div>
                    </div>
                </div>

                <div class="eval-section">
                    <div class="score-line">
                        <span class="score-label">风味评分</span>
                        <span class="score-value">13</span>
                        <span class="score-max">（最高20分）</span>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">麦芽</div>
                        <div class="eval-content">
                            <div class="eval-text" id="flavor-malt-text" onclick="openModal('flavor', 'malt', 'flavor-malt-text')"></div>
                            <button class="copy-btn" onclick="copyText('flavor-malt-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">啤酒花</div>
                        <div class="eval-content">
                            <div class="eval-text" id="flavor-hop-text" onclick="openModal('flavor', 'hop', 'flavor-hop-text')"></div>
                            <button class="copy-btn" onclick="copyText('flavor-hop-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">苦味</div>
                        <div class="eval-content">
                            <div class="eval-text" id="flavor-bitter-text" onclick="openModal('flavor', 'bitterness', 'flavor-bitter-text')"></div>
                            <button class="copy-btn" onclick="copyText('flavor-bitter-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">发酵风味</div>
                        <div class="eval-content">
                            <div class="eval-text" id="flavor-ferment-text" onclick="openModal('flavor', 'fermentation', 'flavor-ferment-text')"></div>
                            <button class="copy-btn" onclick="copyText('flavor-ferment-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">风味平衡</div>
                        <div class="eval-content">
                            <div class="eval-text" id="flavor-balance-text" onclick="openModal('flavor', 'balance', 'flavor-balance-text')"></div>
                            <button class="copy-btn" onclick="copyText('flavor-balance-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">收口/后味</div>
                        <div class="eval-content">
                            <div class="eval-text" id="flavor-finish-text" onclick="openModal('flavor', 'finish', 'flavor-finish-text')"></div>
                            <button class="copy-btn" onclick="copyText('flavor-finish-text')">复制</button>
                        </div>
                    </div>
                </div>

                <div class="eval-section">
                    <div class="score-line">
                        <span class="score-label">口感评分</span>
                        <span class="score-value">3</span>
                        <span class="score-max">（最高5分）</span>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">酒体</div>
                        <div class="eval-content">
                            <div class="eval-text" id="mouthfeel-body-text" onclick="openModal('mouthfeel', 'body', 'mouthfeel-body-text')"></div>
                            <button class="copy-btn" onclick="copyText('mouthfeel-body-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">杀口感</div>
                        <div class="eval-content">
                            <div class="eval-text" id="mouthfeel-carbonation-text" onclick="openModal('mouthfeel', 'carbonation', 'mouthfeel-carbonation-text')"></div>
                            <button class="copy-btn" onclick="copyText('mouthfeel-carbonation-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">酒精热度</div>
                        <div class="eval-content">
                            <div class="eval-text" id="mouthfeel-alcohol-text" onclick="openModal('mouthfeel', 'alcohol', 'mouthfeel-alcohol-text')"></div>
                            <button class="copy-btn" onclick="copyText('mouthfeel-alcohol-text')">复制</button>
                        </div>
                    </div>
                    <div class="eval-row">
                        <div class="eval-label">涩感感</div>
                        <div class="eval-content">
                            <div class="eval-text" id="mouthfeel-astringent-text" onclick="openModal('mouthfeel', 'astringency', 'mouthfeel-astringent-text')"></div>
                            <button class="copy-btn" onclick="copyText('mouthfeel-astringent-text')">复制</button>
                        </div>
                    </div>
                </div>

                <div class="eval-section">
                    <div class="score-line">
                        <span class="score-label">总体评分</span>
                        <span class="score-value">6</span>
                        <span class="score-max">（最高10分）</span>
                    </div>
                    <div class="comment-section">
                        <div class="comment-text" id="overall-comment" onclick="openModal('overall', 'comments', 'overall-comment')">
                            一款非常不错的过桶大麦烈酒，风味复杂，层次丰富，价调平衡。
                        </div>
                        <button class="copy-btn" onclick="copyText('overall-comment')" style="margin-top: 10px;">复制</button>
                    </div>
                </div>

                <div class="final-score">
                    <div>总分</div>
                    <div class="final-score-value">35</div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button class="submit-btn" style="flex: 1; background: #28a745;">入围</button>
                    <button class="submit-btn" style="flex: 1; background: #6c757d;">淘汰</button>
                </div>
                
                <button class="submit-btn" style="margin-top: 10px;">提交</button>
            </div>
        </div>
    </div>

    <!-- 模态框 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title" id="modal-title">选择评语</span>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-options" id="modal-options"></div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal()">取消</button>
                <button class="modal-btn modal-btn-primary" onclick="confirmSelection()">确定</button>
            </div>
        </div>
    </div>

    <script>
        let currentTarget = null;
        let selectedOptions = [];
        let currentFocusIndex = 0;
        let evalTextElements = [];

        // 内联评语数据
        const evaluationData = {
            "aroma": {
                "malt": [
                    "麦芽甜香",
                    "高度深色麦芽果脯",
                    "焦糖香",
                    "烘烤香",
                    "饼干香",
                    "面包香",
                    "蜂蜜香",
                    "太妃糖香",
                    "巧克力香",
                    "咖啡香",
                    "坚果香",
                    "葡萄干香",
                    "无花果香",
                    "李子香",
                    "浓郁麦芽香",
                    "轻微麦芽香",
                    "平衡麦芽香"
                ],
                "hop": [
                    "无",
                    "轻微",
                    "低度",
                    "中低",
                    "中等",
                    "中高",
                    "高度",
                    "浓郁",
                    "柑橘香",
                    "花香",
                    "草本香",
                    "松香",
                    "香料香",
                    "热带水果香",
                    "柠檬香",
                    "橙子香",
                    "葡萄柚香"
                ],
                "fermentation": [
                    "清洁",
                    "轻微酯香",
                    "中度酯香",
                    "高度酯香",
                    "浓郁酯香",
                    "果香",
                    "香蕉香",
                    "苹果香",
                    "梨香",
                    "柠檬香",
                    "酚类香",
                    "胡椒香",
                    "丁香香",
                    "烟熏香",
                    "野生发酵香",
                    "轻微双乙酰",
                    "明显双乙酰"
                ],
                "other": [
                    "过桶风味",
                    "橡木桶香",
                    "威士忌桶香",
                    "朗姆酒桶香",
                    "红酒桶香",
                    "白兰地桶香",
                    "雪莉桶香",
                    "波本桶香",
                    "香草香",
                    "椰子香",
                    "单宁味",
                    "酒精味",
                    "溶剂味",
                    "醋酸味",
                    "异味",
                    "感染味",
                    "氧化味"
                ]
            },
            "appearance": {
                "color": [
                    "稻草色",
                    "金黄色",
                    "琥珀色",
                    "铜色",
                    "红棕色",
                    "深棕色",
                    "黑色",
                    "宝石红色",
                    "深红色",
                    "栗色",
                    "焦糖色",
                    "蜜色",
                    "浅黄色",
                    "深黄色",
                    "橙色",
                    "红铜色",
                    "深琥珀色"
                ],
                "clarity": [
                    "透明",
                    "清澈",
                    "比较清澈",
                    "轻微浑浊",
                    "浑浊",
                    "很浑浊",
                    "不透明",
                    "有颗粒",
                    "有悬浮物",
                    "有沉淀",
                    "薄雾状",
                    "朦胧",
                    "晶莹剔透",
                    "水晶般清澈",
                    "略显浑浊",
                    "明显浑浊",
                    "严重浑浊"
                ],
                "foam": [
                    "白色",
                    "米白色",
                    "淡棕色",
                    "棕色",
                    "深棕色",
                    "奶油色",
                    "象牙色",
                    "灰白色",
                    "浅黄色",
                    "黄色",
                    "深黄色",
                    "橙色",
                    "红棕色",
                    "焦糖色",
                    "咖啡色",
                    "巧克力色",
                    "近乎白色"
                ],
                "foam_retention": [
                    "持久",
                    "较持久",
                    "中等持久",
                    "不太持久",
                    "很快消失",
                    "几乎没有",
                    "丰富持久",
                    "适中持久",
                    "短暂",
                    "瞬间消失",
                    "良好保持",
                    "一般保持",
                    "较差保持",
                    "优秀保持",
                    "完全消失",
                    "快速消散",
                    "缓慢消散"
                ]
            },
            "flavor": {
                "malt": [
                    "麦芽甜味",
                    "高度深色麦芽果脯",
                    "焦糖味",
                    "烘烤味",
                    "饼干味",
                    "面包味",
                    "蜂蜜味",
                    "太妃糖味",
                    "巧克力味",
                    "咖啡味",
                    "坚果味",
                    "葡萄干味",
                    "无花果味",
                    "李子味",
                    "浓郁麦芽味",
                    "轻微麦芽味",
                    "平衡麦芽味"
                ],
                "hop": [
                    "无",
                    "轻微",
                    "低度",
                    "中低",
                    "中等",
                    "中高",
                    "高度",
                    "浓郁",
                    "柑橘味",
                    "花香味",
                    "草本味",
                    "松香味",
                    "香料味",
                    "热带水果味",
                    "柠檬味",
                    "橙子味",
                    "葡萄柚味"
                ],
                "bitterness": [
                    "无",
                    "轻微",
                    "低度",
                    "中低",
                    "适中",
                    "中高",
                    "高度",
                    "浓郁",
                    "强烈",
                    "刺激",
                    "平衡",
                    "不平衡",
                    "过度",
                    "不足",
                    "清洁",
                    "粗糙",
                    "柔和"
                ],
                "fermentation": [
                    "清洁",
                    "轻微酯香",
                    "中度酯香",
                    "高度酯香",
                    "浓郁酯香",
                    "果味",
                    "香蕉味",
                    "苹果味",
                    "梨味",
                    "柠檬味",
                    "酚类味",
                    "胡椒味",
                    "丁香味",
                    "烟熏味",
                    "野生发酵味",
                    "轻微双乙酰",
                    "明显双乙酰"
                ],
                "balance": [
                    "平衡",
                    "比较平衡",
                    "基本平衡",
                    "略显不平衡",
                    "不平衡",
                    "严重不平衡",
                    "麦芽主导",
                    "酒花主导",
                    "苦味主导",
                    "甜味主导",
                    "酸味主导",
                    "协调统一",
                    "层次分明",
                    "复杂平衡",
                    "简单平衡",
                    "动态平衡",
                    "静态平衡"
                ],
                "finish": [
                    "甜",
                    "干",
                    "苦",
                    "酸",
                    "涩",
                    "清洁",
                    "温和",
                    "悠长",
                    "短暂",
                    "平滑",
                    "粗糙",
                    "复杂",
                    "简单",
                    "愉悦",
                    "刺激",
                    "持久",
                    "瞬间"
                ]
            },
            "mouthfeel": {
                "body": [
                    "轻盈",
                    "中低",
                    "中等",
                    "中高",
                    "厚重",
                    "饱满",
                    "单薄",
                    "丰富",
                    "水感",
                    "油腻",
                    "顺滑",
                    "粗糙",
                    "柔和",
                    "强劲",
                    "适中",
                    "均衡",
                    "协调"
                ],
                "carbonation": [
                    "无",
                    "轻微",
                    "低度",
                    "中低",
                    "中等",
                    "中高",
                    "高度",
                    "过度",
                    "刺激",
                    "柔和",
                    "细腻",
                    "粗糙",
                    "绵密",
                    "稀疏",
                    "持久",
                    "短暂",
                    "适中"
                ],
                "alcohol": [
                    "无",
                    "轻微",
                    "低度",
                    "中低",
                    "中等",
                    "中高",
                    "高度",
                    "强烈",
                    "刺激",
                    "温和",
                    "平衡",
                    "突出",
                    "隐藏",
                    "协调",
                    "不协调",
                    "过度",
                    "不足"
                ],
                "astringency": [
                    "无",
                    "轻微",
                    "低度",
                    "中低",
                    "中等",
                    "中高",
                    "高度",
                    "过度",
                    "顺滑",
                    "粗糙",
                    "干涩",
                    "刺激",
                    "平衡",
                    "不平衡",
                    "适中",
                    "强烈",
                    "温和"
                ],
                "texture": [
                    "顺滑",
                    "粗糙",
                    "柔和",
                    "硬朗",
                    "丝滑",
                    "粘稠",
                    "水润",
                    "油腻",
                    "干燥",
                    "湿润",
                    "细腻",
                    "粗糙",
                    "均匀",
                    "不均匀",
                    "协调",
                    "突兀",
                    "自然"
                ]
            },
            "overall": {
                "comments": [
                    "一款优秀的啤酒，各方面表现均衡出色",
                    "一款非常不错的过桶大麦烈酒，风味复杂，层次丰富，价调平衡",
                    "整体表现良好，有一定的风格特色",
                    "风味平衡，口感顺滑，是一款不错的啤酒",
                    "香气浓郁，口感丰富，层次分明",
                    "色泽诱人，泡沫丰富，口感平衡",
                    "传统风格，酿造工艺精湛",
                    "创新风格，有独特的个性",
                    "各项指标达标，符合风格要求",
                    "有一定的改进空间，但整体可接受",
                    "风味独特，值得品尝",
                    "酿造技术娴熟，品质可靠",
                    "口感清爽，适合夏季饮用",
                    "浓郁厚重，适合冬季品尝",
                    "果香浓郁，酒花平衡",
                    "麦芽香甜，余味悠长",
                    "复杂度高，层次丰富"
                ]
            }
        };

        function copyText(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            if (text && text !== '点击选择评语') {
                navigator.clipboard.writeText(text).then(() => {
                    const button = element.nextElementSibling;
                    const originalText = button.textContent;
                    button.textContent = '已复制';
                    button.style.background = '#28a745';
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.style.background = '#5856d6';
                    }, 1000);
                });
            }
        }

        function openModal(category, subcategory, targetId) {
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalOptions = document.getElementById('modal-options');
            
            currentTarget = targetId;
            selectedOptions = [];
            
            // 设置标题
            const titles = {
                'aroma': '香气',
                'appearance': '外观',
                'flavor': '风味',
                'mouthfeel': '口感',
                'overall': '总体'
            };
            
            const subtitles = {
                'malt': '麦芽',
                'hop': '啤酒花',
                'fermentation': '发酵风味',
                'other': '其他',
                'color': '颜色',
                'clarity': '清澈度',
                'foam': '泡沫颜色',
                'foam_retention': '泡沫持久度',
                'bitterness': '苦味',
                'balance': '风味平衡',
                'finish': '收口/后味',
                'body': '酒体',
                'carbonation': '杀口感',
                'alcohol': '酒精热度',
                'astringency': '涩感感',
                'texture': '质地',
                'comments': '评语'
            };
            
            modalTitle.textContent = `选择${titles[category]}${subtitles[subcategory]}评语`;
            
            // 清空选项
            modalOptions.innerHTML = '';
            
            // 加载选项
            if (evaluationData[category] && evaluationData[category][subcategory]) {
                const options = evaluationData[category][subcategory];
                options.forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'modal-option';
                    optionElement.textContent = option;
                    optionElement.onclick = () => toggleOption(optionElement, option);
                    modalOptions.appendChild(optionElement);
                });
            }
            
            modal.style.display = 'block';
        }

        function toggleOption(element, option) {
            const index = selectedOptions.indexOf(option);
            if (index > -1) {
                selectedOptions.splice(index, 1);
                element.classList.remove('selected');
            } else {
                selectedOptions.push(option);
                element.classList.add('selected');
            }
        }

        function confirmSelection() {
            if (currentTarget && selectedOptions.length > 0) {
                const targetElement = document.getElementById(currentTarget);
                const newContent = selectedOptions.join('、');
                targetElement.textContent = newContent;
                
                // 自动复制到剪贴板
                navigator.clipboard.writeText(newContent).then(() => {
                    console.log('已复制到剪贴板:', newContent);
                }).catch(err => {
                    console.error('复制失败:', err);
                });
            }
            closeModal();
            
            // 确认后光标自动向下移动
            currentFocusIndex = (currentFocusIndex + 1) % evalTextElements.length;
            updateFocus();
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            modal.style.display = 'none';
            currentTarget = null;
            selectedOptions = [];
        }

        // 点击模态框外部关闭
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // 更新焦点显示
        function updateFocus() {
            evalTextElements.forEach((element, index) => {
                if (index === currentFocusIndex) {
                    element.classList.add('focused');
                } else {
                    element.classList.remove('focused');
                }
            });
        }

        // 获取当前焦点元素的模态框参数
        function getCurrentModalParams() {
            const element = evalTextElements[currentFocusIndex];
            const onclick = element.getAttribute('onclick');
            if (onclick) {
                const match = onclick.match(/openModal\('([^']+)',\s*'([^']+)',\s*'([^']+)'\)/);
                if (match) {
                    return {
                        category: match[1],
                        subcategory: match[2],
                        targetId: match[3]
                    };
                }
            }
            return null;
        }

        // 键盘快捷键
        document.addEventListener('keydown', function(event) {
            const modal = document.getElementById('modal');
            
            if (modal.style.display === 'block') {
                // 模态框打开时的快捷键
                if (event.key === 'Enter' || event.key === ' ' || event.key === 'Spacebar') {
                    event.preventDefault();
                    confirmSelection();
                } else if (event.key === 'Escape') {
                    event.preventDefault();
                    closeModal();
                }
            } else {
                // 模态框关闭时的快捷键
                if (event.key === 'ArrowDown') {
                    event.preventDefault();
                    currentFocusIndex = (currentFocusIndex + 1) % evalTextElements.length;
                    updateFocus();
                } else if (event.key === 'ArrowUp') {
                    event.preventDefault();
                    currentFocusIndex = (currentFocusIndex - 1 + evalTextElements.length) % evalTextElements.length;
                    updateFocus();
                } else if (event.key === ' ' || event.key === 'Spacebar') {
                    event.preventDefault();
                    const params = getCurrentModalParams();
                    if (params) {
                        openModal(params.category, params.subcategory, params.targetId);
                    }
                }
            }
        });

        // 清空所有评语
        function clearAllComments() {
            if (confirm('确定要清空所有评语吗？此操作不可撤销。')) {
                evalTextElements.forEach(element => {
                    element.textContent = '';
                });
                // 重置焦点到第一项
                currentFocusIndex = 0;
                updateFocus();
            }
        }

        // 设置默认内容
        function setDefaultContent() {
            document.getElementById('aroma-malt-text').textContent = '高度深色麦芽果脯、葡萄干';
            document.getElementById('aroma-hop-text').textContent = '中等';
            document.getElementById('aroma-ferment-text').textContent = '高度酯香';
            document.getElementById('aroma-other-text').textContent = '过桶风味';
            
            document.getElementById('appearance-color-text').textContent = '宝石红色';
            document.getElementById('appearance-clarity-text').textContent = '比较清澈';
            document.getElementById('appearance-foam-text').textContent = '白色';
            
            document.getElementById('flavor-malt-text').textContent = '高度深色麦芽果脯、葡萄干';
            document.getElementById('flavor-hop-text').textContent = '中低';
            document.getElementById('flavor-bitter-text').textContent = '适中';
            document.getElementById('flavor-ferment-text').textContent = '浓郁酯香';
            document.getElementById('flavor-balance-text').textContent = '比较平衡';
            document.getElementById('flavor-finish-text').textContent = '甜';
            
            document.getElementById('mouthfeel-body-text').textContent = '中高';
            document.getElementById('mouthfeel-carbonation-text').textContent = '中等';
            document.getElementById('mouthfeel-alcohol-text').textContent = '强烈';
            document.getElementById('mouthfeel-astringent-text').textContent = '顺滑';
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 收集所有评语文本元素
            evalTextElements = Array.from(document.querySelectorAll('.eval-text, .comment-text'));
            
            // 设置默认内容
            setDefaultContent();
            
            // 初始化焦点
            updateFocus();
        });
    </script>
</body>
</html>